= Point-in-Time Restore

The introduction of Point-in-Time Restore in version 4.1.0 is designed to enable users to restore the database to a previous time point, they can provide a timestamp and restore to it using previous made backups, even though no backup has been conducted at exactly that time point.
This feature is based on xref:tigergraph-server:backup-and-restore:differential-backups.adoc[Differential Backup].

== Usage

To perform point-in-time restore, run the following command:

[console, gsql]
----
$ gadmin backup restore <timepoint_to_restore> --time-point
----

For example, if you want to restore the cluster to the timepoint `2024-06-01T14:24:31Z` , run `gadmin backup restore 2024-06-01T14:24:31Z --time-point`. remember, the timepoint is precise to only seconds, other minor time parts will be truncated.

The point-in-time restore is based on full backup and incremental backup. So we need to ensure the time point to restore is not under these cases:
===
. the time points before the first full backup or after the current time.
. the time points before the last restore and aren’t covered by existing backups. here not covered means the time points are not contained by any backup’s time point points range [POINT-IN-TIME START TIME,  CREATED AT]. We can check the backup’s time points range by `gadmin backup list`. here is an example:

[console, gsql]
---
$ gadmin backup list
+------------------------------+-------------+---------+--------+------------------------------+--------------------------+----------------------+
|             TAG              |    TYPE     | VERSION |  SIZE  |             BASE             | POINT-IN-TIME START TIME |      CREATED AT      |
+------------------------------+-------------+---------+--------+------------------------------+--------------------------+----------------------+
| backup-2024-06-13T061939.131 | FULL        | 4.1.0   | 1.5 MB |                              | 2024-06-13T06:19:39Z     | 2024-06-13T06:19:39Z |
| backup-2024-06-13T063915.054 | INCREMENTAL | 4.1.0   | 1.5 MB | backup-2024-06-13T061939.131 | 2024-06-13T06:19:39Z     | 2024-06-13T06:39:15Z |
| backup-2024-06-13T081939.120 | FULL        | 4.1.0   | 1.5 MB |                              | 2024-06-13T08:19:39Z     | 2024-06-13T08:19:39Z |
+------------------------------+-------------+---------+--------+------------------------------+--------------------------+----------------------+
---
here, the time range for backup `backup-2024-06-13T061939.131` is `[2024-06-13T06:19:39Z,2024-06-13T06:19:39Z]`, therefore, for a full backup is just a point. As for the incremental backup `backup-2024-06-13T063915.054`, its range is `[2024-06-13T06:19:39Z , 2024-06-13T06:39:15Z]`. so, for instance, if we have performed a restore at `2024-06-14T06:19:39Z`. And then we can’t restore to the timepoint `2024-06-13T07:00:00Z`, for it is not in any backup's time range. however, `2024-06-13T06:35:00Z` is supported for it is covered by the time range `[2024-06-13T06:19:39Z , 2024-06-13T06:39:15Z]` of the backup `backup-2024-06-13T063915.054`.
===

[NOTE]
===
because the restore action will make the uncovered timepoint unavailable to restore, if you are not very sure about the time point to restore,  we’d better ensure the possible time points are all covered by existing backups. if there is not this kind of backup, you may create a by `gadmin backup create <backup_tag> --incremental --base <full_backup_tag>`, the new backup will cover the range from the full backup <full_backup_tag>'s create time to the current time.
===

== Key Benefits

The primary advantage of Point-in-Time Restore is the flexibility it offers in selecting any specific time point on the timeline for restoration.

.Key Benefit Scenario
====
. A user creates a full backup on __Sunday__.

. During the week, user creates a differential backup on every day 10pm.

. On Tursday, user finds there are unwanted changes made on Wednesday around 2pm.

. User can restore system to 1:55pm of Wednesday instead of the backup made on Tuesday 10pm.

. The changes made between Tuesday 10pm and Wednesday 1:55pm are saved this way.
====

Summery of key benefits:

* Precise recover time point to save a much as possible correct work made to database.


== Limitations and Considerations

Currently, the Point-in-Time Restore feature has these known limitations:

.Point-in-Time Restore examples.
image::PIT_restore.png[]

* GSQL’s content can not be restored to the version of user provided time point, like catalog(schemas,RBAC). After completion of a point in time restore, its version will be the same as the differential backup used, that is the nearest differential backup covered that time point.
* Accuracy, error range of a couple of minutes. To ensure data consistency, point-in-time restore has an error range of a couple of minutes. So if disaster/unwanted operation happened at a timestamp, user should point in time restore to at least 2 mins in advance.
* Cannot point-in-time restore to a timestamp not covered by a differential backup. A timestamp before the existing earliest full backup cannot be restored to anyway. Other timestamps not covered by an existing differential backup will be reminded to kick off a new differential backup when executing point-in-time restore. After successful completion of the prompted differential backup, user would be able to point in time restore.
** To maximize the potential of Point-in-Time Restore, users are expected to do backups regulary. A good example can be doing weekly full backup and daily differential backup in days between two full backups.


